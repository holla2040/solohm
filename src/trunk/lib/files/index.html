<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html ng-app="solohmApp">
  <head>
    <meta charset="utf-8">
    <title>SolOhm</title>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js"></script>

    <script>
      var solohmApp = angular.module('solohmApp', []);
      solohmApp.controller('solohmCtrl', function ($scope, $http, $timeout){
        var statusLoop = function() {
            $http.get('status.json').success(function(data) {
              $scope.status = data;
              $scope.lastUpdate = new Date();
            });
            $timeout(statusLoop, 1000);
        };

        var sweep = function() {
            $http.get('loadsweep.json').success(function(data) {
                console.log(data);
                $('#loadsweep').highcharts({
                    chart: {
                        type: 'scatter',
                        zoomType: 'x'
                    },
                    credits: {
                          enabled: false
                    },
                    title: {
                        text: 'Panel IV Curve'
                    },
                    subtitle: {
                        text: 'serial# here'
                    },
                    xAxis: {
                        title: {
                            text: 'Voltage'
                        },
                        min: 0,
                    },
                    yAxis: {
                        title: {
                            text: 'Current'
                        },
                        min: 0
                    },
                    tooltip: {
                        headerFormat: '<b>{series.name}</b><br>',
                        pointFormat: '{point.x:.2f}: {point.y:.2f}'
                    },

                    plotOptions: {
                        spline: {
                            marker: {
                                enabled: true
                            }
                        }
                    },

                    series: [{
                        showInLegend: false,      
                        data:data
                    }]
                });
            });
        };
        
        
        sweep();

        statusLoop();
      });
    </script>
    <style>
        .right {
            text-align: right;
        }
    </style>
    <script src="http://code.jquery.com/jquery-1.9.1.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/modules/exporting.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
    });
    </script>
  </head>
  <body ng-controller="solohmCtrl">
    <table>
      <tr>
        <th>Desc</th>
        <th>Value</th>
        <th>Unit</th>
      </tr>
      <tr>
        <td>vpanel</td>
        <td class='right'>{{status.vpanel|number:2}}</td>
        <td>V</td>
      </tr>
      <tr>
        <td>ipanel</td>
        <td class='right'>{{status.ipanel|number:2}}</td>
        <td>A</td>
      </tr>
      <tr>
        <td>vbatt1</td>
        <td class='right'>{{status.vbatt1|number:2}}</td>
        <td>V</td>
      </tr>
      <tr>
        <td>vbatt2</td>
        <td class='right'>{{status.vbatt2|number:2}}</td>
        <td>V</td>
      </tr>
      <tr>
        <td>vbatt3</td>
        <td class='right'>{{status.vbatt3|number:2}}</td>
        <td>V</td>
      </tr>
      <tr>
        <td>uptime</td>
        <td class='right'>{{status.uptime|number:0}}</td>
        <td>S</td>
      </tr>
      <tr>
        <td>daysensor</td>
        <td class='right'>{{status.daysensor|number:0}}</td>
        <td></td>
      </tr>
      <tr>
        <td>updated</td>
        <td class='right' colspan='2'>{{lastUpdate| date:'yy-MM-dd HH:mm:ss'}}</td>
      </tr>
    </table>
    <hr>
    <div id="loadsweep" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
  </body>
</html>

