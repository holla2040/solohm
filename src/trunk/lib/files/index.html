<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html ng-app="solohmApp">
  <head>
    <meta charset="utf-8">
    <title>SolOhm</title>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.11/angular.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
    <script src="http://code.highcharts.com/modules/exporting.js" type="text/javascript"></script>

    <script>
      var solohmApp = angular.module('solohmApp', []);
      solohmApp.controller('solohmCtrl', function ($scope, $http, $timeout){
        var statusLoop = function() {
            $http.get('status.json').success(function(data) {
              $scope.status = data;
              $scope.lastUpdate = new Date();
            });
            $timeout(statusLoop, 1000);
        };

        $scope.sweep = function() {
            console.log("sweep");
            $http.get('loadsweep.json').success(function(data) {
                $('#loadsweep').highcharts({
                    chart: {
                        type: 'scatter',
                        zoomType: 'xy'
                    },
                    credits: {
                          enabled: false
                    },
                    title: {
                        text: 'Panel IV Curve'
                    },
                    subtitle: {
                        text: 'serial# here'
                    },
                    xAxis: {
                        title: {
                            text: 'Voltage'
                        },
                        min: 0,
                    },
                    yAxis: {
                        title: {
                            text: 'Current'
                        },
                        min: 0
                    },
                    tooltip: {
                        headerFormat: '<b>{series.name}</b><br>',
                        pointFormat: '{point.y:.2f}V@{point.y:.2f}A'
                    },

                    plotOptions: {
                        spline: {
                            marker: {
                                enabled: true
                            }
                        }
                    },
                    series: [{
                        name: "Panel V@A",
                        showInLegend: false,      
                        animation: false,
                        marker: {symbol:'circle',radius:2},
                        data:data
                    }]
                });
            });
        };
        
        $timeout($scope.sweep, 2000);

        statusLoop();
      });
    </script>
    <style>
        .right {
            text-align: right;
        }
    </style>
  </head>
  <body ng-controller="solohmCtrl">
    <div style="float:left">
        <table>
          <tr>
            <th>Variable</th>
            <th>Value</th>
            <th></th>
          </tr>
          <tr>
            <td>Uptime</td>
            <td class='right'>{{status.uptime|number:0}}</td>
            <td>S</td>
          </tr>
          <tr>
            <td>Mode</sub></td>
            <td class='right'>{{status.mode}}</td>
            <td></td>
          </tr>
          <tr>
            <td>V<sub>panel</sub></td>
            <td class='right'>{{status.vpanel|number:2}}</td>
            <td>V</td>
          </tr>
          <tr>
            <td>I<sub>panel</sub></td>
            <td class='right'>{{status.ipanel|number:2}}</td>
            <td>A</td>
          </tr>
          <tr>
            <td>R<sub>load</sub></td>
            <td class='right'>{{status.rload|number:0}}</td>
            <td>&ohm;</td>
          </tr>
          <tr>
            <td>V<sub>batt</sub></td>
            <td class='right'>{{status.vbatt|number:2}}</td>
            <td>V</td>
          </tr>
          <tr>
            <td>V<sub>batt1</sub></td>
            <td class='right'>{{status.vbatt1|number:2}}</td>
            <td>V</td>
          </tr>
          <tr>
            <td>V<sub>batt2</sub></td>
            <td class='right'>{{status.vbatt2|number:2}}</td>
            <td>V</td>
          </tr>
          <tr>
            <td>V<sub>batt3</sub></td>
            <td class='right'>{{status.vbatt3|number:2}}</td>
            <td>V</td>
          </tr>
          <tr>
            <td>Day Sensor</td>
            <td class='right'>{{status.daysensor|number:0}}</td>
            <td></td>
          </tr>
          <tr>
            <td>Updated</td>
            <td class='right' colspan='2'>{{lastUpdate| date:'HH:mm:ss'}}</td>
          </tr>
        </table>
        <button ng-click="sweep()">Sweep</button>
    </div>
    <div id="loadsweep" style="float:left" style="min-width: 400px; height: 500px; margin: 0 auto">Requesting data ...</div>
  </body>
</html>

